<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Manage Courses</title>-->
<!--    <link rel="stylesheet" href="/css/bootstrap.min.css">-->
<!--    <style>-->
<!--        .file-group, .article-group, .quiz-group { display: none; }-->
<!--        .quiz-question { border: 1px dashed #ccc; padding: 10px; margin-bottom: 10px; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{'layout/base'}">
<style>
        .file-group, .article-group, .quiz-group { display: none; }
        .quiz-question { border: 1px dashed #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
<section layout:fragment="content" class="text-gray-600 body-font">
<div class="container mt-5">
    <h2>Manage Courses</h2>

    <!-- Flash messages -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Create new course -->
    <form th:action="@{/dr/courses/create}" method="post" class="mb-4">
        <div class="input-group">
            <input type="text" name="title" class="form-control" placeholder="New Course Title" required>
            <button type="submit" class="btn btn-primary">Create Course</button>
        </div>
    </form>

    <!-- Courses list -->
    <div th:each="course : ${courses}" class="card mb-3">
        <div class="card-body">
            <h5 th:text="${course.title}"></h5>

            <!-- Tutorials list -->
            <ul class="list-group mb-2">
                <li class="list-group-item" th:each="tut : ${tutorialsMap[course.id]}">
                    <span th:text="${tut.title} + ' (' + tut.type + ')'"></span>
                    <form th:action="@{'/dr/tutorials/delete/' + ${tut.id}}" method="post" class="d-inline float-end">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </li>
            </ul>

            <!-- Add tutorial -->
            <form th:action="@{'/dr/courses/' + ${course.id} + '/tutorials/add'}"
                  method="post" enctype="multipart/form-data" class="tutorial-form">
                <input type="text" name="title" class="form-control mb-2" placeholder="Tutorial Title" required>

                <select name="type" class="form-select mb-2 tutorial-type" required>
                    <option th:each="type : ${tutorialTypes}" th:value="${type}" th:text="${type}"></option>
                </select>

                <!-- File input -->
                <div class="file-group mb-2">
                    <input type="file" name="file" class="form-control">
                </div>

                <!-- Article input -->
                <div class="article-group mb-2">
                    <textarea name="articleContent" class="form-control" placeholder="Article content"></textarea>
                </div>

                <!-- Quiz input -->
                <div class="quiz-group mb-2">
                    <div class="quiz-container"></div>
                    <button class="btn btn-secondary btn-sm add-quiz-question mb-2">Add Question</button>
                </div>

                <button type="submit" class="btn btn-success">Add Tutorial</button>
            </form>
        </div>
    </div>

    <!-- Pagination -->
    <nav th:if="${totalPages > 1}">
        <ul class="pagination">
            <li class="page-item" th:classappend="${currentPage == 0}? 'disabled'">
                <a class="page-link" th:href="@{/dr/courses(page=${currentPage-1})}">Previous</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0,totalPages-1)}"
                th:classappend="${currentPage == i}? 'active'">
                <a class="page-link" th:href="@{/dr/courses(page=${i})}" th:text="${i+1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages-1}? 'disabled'">
                <a class="page-link" th:href="@{/dr/courses(page=${currentPage+1})}">Next</a>
            </li>
        </ul>
    </nav>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".tutorial-form").forEach(form => {
            const typeSelect = form.querySelector(".tutorial-type");
            const fileGroup = form.querySelector(".file-group");
            const articleGroup = form.querySelector(".article-group");
            const quizGroup = form.querySelector(".quiz-group");
            const quizContainer = form.querySelector(".quiz-container");
            const addQuizBtn = form.querySelector(".add-quiz-question");

            const updateInputs = () => {
                const type = typeSelect.value;
                fileGroup.style.display = (type === "VIDEO" || type === "PDF") ? "block" : "none";
                articleGroup.style.display = (type === "ARTICLE") ? "block" : "none";
                quizGroup.style.display = (type === "QUIZ") ? "block" : "none";
            };

            typeSelect.addEventListener("change", updateInputs);
            updateInputs();

            addQuizBtn.addEventListener("click", e => {
                e.preventDefault();
                const idx = quizContainer.children.length;
                const questionDiv = document.createElement("div");
                questionDiv.classList.add("quiz-question");
                questionDiv.innerHTML = `
                <input type="text" name="questions" class="form-control mb-1" placeholder="Question ${idx+1}" required>
                <input type="text" name="options" class="form-control mb-1" placeholder="Options (comma-separated)" required>
                <input type="text" name="answers" class="form-control mb-1" placeholder="Answer" required>
            `;
                quizContainer.appendChild(questionDiv);
            });

            form.addEventListener("submit", e => {
                const type = typeSelect.value;
                if ((type === "VIDEO" || type === "PDF") && !fileGroup.querySelector("input").files.length) {
                    e.preventDefault(); alert("Please select a file.");
                }
                if (type === "ARTICLE" && !articleGroup.querySelector("textarea").value.trim()) {
                    e.preventDefault(); alert("Please enter article content.");
                }
                if (type === "QUIZ" && quizContainer.children.length === 0) {
                    e.preventDefault(); alert("Please add at least one quiz question.");
                }
            });
        });
    });
</script>
<!--</body>-->
</section>
</html>
