<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{'layout/base'}">

<head>
    <title>Manage Courses</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/fontawesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/manage-courses.css}">
</head>
<section layout:fragment="content" class="container mt-5">
    <h2 class="mb-4">Courses Management</h2>

    <!-- Flash messages -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Create new course -->
    <form th:action="@{/dr/courses/create}" method="post" class="mb-4 row g-2">
        <div class="col-md-3">
            <input type="text" name="title" class="form-control" placeholder="Course Title" required>
        </div>
        <div class="col-md-3">
            <input type="text" name="courseName" class="form-control" placeholder="Course Name" required>
        </div>
        <div class="col-md-3">
            <input type="text" name="description" class="form-control" placeholder="Description">
        </div>
        <div class="col-md-2">
            <input type="number" name="price" class="form-control" placeholder="Price">
        </div>
        <div class="col-md-1 d-grid">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </form>

    <!-- Courses List -->
    <div th:each="course : ${courses}" class="card mb-3 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div>
                <h5 th:text="${course.title}"></h5>
                <small th:text="'Name: ' + ${course.courseName} + ' | Price: $' + ${course.price}"></small>
            </div>
            <div>
                <a th:href="@{'/dr/courses/edit/' + ${course.id}}" class="btn btn-sm btn-warning me-1">
                    <i class="fas fa-edit"></i>
                </a>
                <form th:action="@{'/dr/courses/delete/' + ${course.id}}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                </form>
            </div>
        </div>

        <div class="card-body">
            <!-- Tutorials Section -->
            <h6>Tutorials</h6>
            <ul class="list-group mb-2">
                <li th:each="tut : ${tutorialsMap[course.id].content}" class="list-group-item d-flex justify-content-between">
                    <span th:text="${tut.title} + ' (' + tut.type + ')'"></span>
                    <div>
                        <a th:href="@{'/dr/tutorials/edit/' + ${tut.id}}" class="btn btn-sm btn-warning me-1"><i class="fas fa-edit"></i></a>
                        <form th:action="@{'/dr/tutorials/delete/' + ${tut.id}}" method="post" class="d-inline">
                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>
                        </form>
                    </div>
                </li>
            </ul>

            <!-- Tutorial Pagination -->
            <nav th:if="${tutorialsMap[course.id].totalPages > 1}">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${tutorialsMap[course.id].number == 0}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'tutorialPage_'+course.id}=${tutorialsMap[course.id].number-1})}">
                            Previous
                        </a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, tutorialsMap[course.id].totalPages-1)}"
                        th:classappend="${tutorialsMap[course.id].number == i}? 'active'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'tutorialPage_'+course.id}=${i})}"
                           th:text="${i+1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${tutorialsMap[course.id].number == tutorialsMap[course.id].totalPages-1}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'tutorialPage_'+course.id}=${tutorialsMap[course.id].number+1})}">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Students Section -->
            <h6>Enrolled Students</h6>
            <ul class="list-group mb-2">
                <li th:each="stu : ${studentsMap[course.id].content}" class="list-group-item d-flex justify-content-between">
                    <span th:text="${stu.fullName} + ' (' + stu.email + ')'"></span>
                    <div>
                        <a th:href="@{'/dr/students/edit/' + ${stu.id}}" class="btn btn-sm btn-warning me-1"><i class="fas fa-edit"></i></a>
                        <form th:action="@{'/dr/students/remove/' + ${stu.id}}" method="post" class="d-inline">
                            <button class="btn btn-sm btn-danger"><i class="fas fa-user-slash"></i></button>
                        </form>
                    </div>
                </li>
            </ul>

            <!-- Student Pagination -->
            <nav th:if="${studentsMap[course.id].totalPages > 1}">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${studentsMap[course.id].number == 0}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'studentPage_'+course.id}=${studentsMap[course.id].number-1})}">
                            Previous
                        </a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, studentsMap[course.id].totalPages-1)}"
                        th:classappend="${studentsMap[course.id].number == i}? 'active'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'studentPage_'+course.id}=${i})}"
                           th:text="${i+1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${studentsMap[course.id].number == studentsMap[course.id].totalPages-1}? 'disabled'">
                        <a class="page-link"
                           th:href="@{/dr/courses(page=${currentPage}, ${'studentPage_'+course.id}=${studentsMap[course.id].number+1})}">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>

<!--            &lt;!&ndash; Tutorials &ndash;&gt;-->
<!--            <h6>Tutorials</h6>-->
<!--            <ul class="list-group mb-3">-->
<!--                <li th:each="tut : ${tutorialsMap[course.id]}" class="list-group-item d-flex justify-content-between align-items-center">-->
<!--                    <span th:text="${tut.title} + ' (' + tut.type + ')'"></span>-->
<!--                    <div>-->
<!--                        <a th:href="@{'/dr/tutorials/edit/' + ${tut.id}}" class="btn btn-sm btn-warning me-1"><i class="fas fa-edit"></i></a>-->
<!--                        <form th:action="@{'/dr/tutorials/delete/' + ${tut.id}}" method="post" class="d-inline">-->
<!--                            <button type="submit" class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </li>-->
<!--            </ul>-->

<!--            &lt;!&ndash; Add Tutorial &ndash;&gt;-->
<!--            <form th:action="@{'/dr/courses/' + ${course.id} + '/tutorials/add'}" method="post" enctype="multipart/form-data" class="tutorial-form mb-3">-->
<!--                <div class="row g-2">-->
<!--                    <div class="col-md-3"><input type="text" name="title" class="form-control" placeholder="Tutorial Title" required></div>-->
<!--                    <div class="col-md-3">-->
<!--                        <select name="type" class="form-select tutorial-type" required>-->
<!--                            <option th:each="type : ${tutorialTypes}" th:value="${type}" th:text="${type}"></option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                    <div class="col-md-3 file-group"><input type="file" name="file" class="form-control"></div>-->
<!--                    <div class="col-md-3 article-group"><textarea name="articleContent" class="form-control" placeholder="Article Content"></textarea></div>-->
<!--                    <div class="col-12 quiz-group">-->
<!--                        <div class="quiz-container mb-2"></div>-->
<!--                        <button class="btn btn-secondary btn-sm add-quiz-question mb-2"><i class="fas fa-plus"></i> Add Question</button>-->
<!--                    </div>-->
<!--                    <div class="col-md-2">-->
<!--                        <button type="submit" class="btn btn-success w-100"><i class="fas fa-plus-circle"></i> Add Tutorial</button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </form>-->

<!--            &lt;!&ndash; Enrolled Students &ndash;&gt;-->
<!--            <h6>Enrolled Students</h6>-->
<!--            <ul class="list-group mb-2">-->
<!--                <li th:each="stu : ${studentsMap[course.id]} ?: ${#lists.newArrayList()}" class="list-group-item d-flex justify-content-between align-items-center">-->
<!--                    <span th:text="${stu.fullName} + ' (' + stu.email + ')'"></span>-->
<!--                    <div>-->
<!--                        <a th:href="@{'/dr/students/edit/' + ${stu.id}}" class="btn btn-sm btn-warning me-1"><i class="fas fa-edit"></i></a>-->
<!--                        <form th:action="@{'/dr/students/remove/' + ${stu.id}}" method="post" class="d-inline">-->
<!--                            <button type="submit" class="btn btn-sm btn-danger"><i class="fas fa-user-slash"></i></button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </li>-->
<!--            </ul>-->
        </div>
    </div>

    <!-- Pagination -->
    <nav th:if="${totalPages > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0}? 'disabled'"><a class="page-link" th:href="@{/dr/courses(page=${currentPage-1})}">Previous</a></li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0,totalPages-1)}" th:classappend="${currentPage == i}? 'active'">
                <a class="page-link" th:href="@{/dr/courses(page=${i})}" th:text="${i+1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages-1}? 'disabled'"><a class="page-link" th:href="@{/dr/courses(page=${currentPage+1})}">Next</a></li>
        </ul>
    </nav>
</section>

<script th:src="@{/js/manage-courses.js}"></script>

<!--<section layout:fragment="content" class="container mt-5">-->
<!--    <h2 class="mb-4">Courses Management</h2>-->

<!--    &lt;!&ndash; Flash messages &ndash;&gt;-->
<!--    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>-->
<!--    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>-->

<!--    &lt;!&ndash; Create new course &ndash;&gt;-->
<!--    <form th:action="@{/dr/courses/create}" method="post" class="mb-4 d-flex">-->
<!--        <input type="text" name="title" class="form-control me-2" placeholder="New Course Title" required>-->
<!--        <button type="submit" class="btn btn-primary">-->
<!--            <i class="fas fa-plus"></i> Add Course-->
<!--        </button>-->
<!--    </form>-->

<!--    &lt;!&ndash; Courses list &ndash;&gt;-->
<!--    <div th:each="course : ${courses}" class="card mb-3 shadow-sm">-->
<!--        <div class="card-header d-flex justify-content-between align-items-center">-->
<!--            <h5 th:text="${course.title}"></h5>-->
<!--            <div>-->
<!--                <a th:href="@{'/dr/courses/edit/' + ${course.id}}" class="btn btn-sm btn-warning me-1">-->
<!--                    <i class="fas fa-edit"></i>-->
<!--                </a>-->
<!--                <form th:action="@{'/dr/courses/delete/' + ${course.id}}" method="post" class="d-inline">-->
<!--                    <button type="submit" class="btn btn-sm btn-danger">-->
<!--                        <i class="fas fa-trash-alt"></i>-->
<!--                    </button>-->
<!--                </form>-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="card-body">-->
<!--            &lt;!&ndash; Tutorials &ndash;&gt;-->
<!--            <h6>Tutorials</h6>-->
<!--            <ul class="list-group mb-3">-->
<!--                <li th:each="tut : ${tutorialsMap[course.id]}" class="list-group-item d-flex justify-content-between align-items-center">-->
<!--                    <span th:text="${tut.title} + ' (' + tut.type + ')'"></span>-->
<!--                    <div>-->
<!--                        <a th:href="@{'/dr/tutorials/edit/' + ${tut.id}}" class="btn btn-sm btn-warning me-1">-->
<!--                            <i class="fas fa-edit"></i>-->
<!--                        </a>-->
<!--                        <form th:action="@{'/dr/tutorials/delete/' + ${tut.id}}" method="post" class="d-inline">-->
<!--                            <button type="submit" class="btn btn-sm btn-danger">-->
<!--                                <i class="fas fa-trash-alt"></i>-->
<!--                            </button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </li>-->
<!--            </ul>-->

<!--            &lt;!&ndash; Add Tutorial &ndash;&gt;-->
<!--            <form th:action="@{'/dr/courses/' + ${course.id} + '/tutorials/add'}"-->
<!--                  method="post" enctype="multipart/form-data" class="tutorial-form mb-3">-->
<!--                <div class="row g-2">-->
<!--                    <div class="col-md-4">-->
<!--                        <input type="text" name="title" class="form-control" placeholder="Tutorial Title" required>-->
<!--                    </div>-->
<!--                    <div class="col-md-3">-->
<!--                        <select name="type" class="form-select tutorial-type" required>-->
<!--                            <option th:each="type : ${tutorialTypes}" th:value="${type}" th:text="${type}"></option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                    <div class="col-md-3 file-group">-->
<!--                        <input type="file" name="file" class="form-control">-->
<!--                    </div>-->
<!--                    <div class="col-md-3 article-group">-->
<!--                        <textarea name="articleContent" class="form-control" placeholder="Article Content"></textarea>-->
<!--                    </div>-->
<!--                    <div class="col-12 quiz-group">-->
<!--                        <div class="quiz-container mb-2"></div>-->
<!--                        <button class="btn btn-secondary btn-sm add-quiz-question mb-2">-->
<!--                            <i class="fas fa-plus"></i> Add Question-->
<!--                        </button>-->
<!--                    </div>-->
<!--                    <div class="col-md-2">-->
<!--                        <button type="submit" class="btn btn-success w-100">-->
<!--                            <i class="fas fa-plus-circle"></i> Add Tutorial-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </form>-->

<!--            &lt;!&ndash; Students &ndash;&gt;-->
<!--            <h6>Enrolled Students</h6>-->
<!--            <ul class="list-group mb-2">-->
<!--                <li th:each="stu : ${studentsMap[course.id]} ?: ${#lists.newArrayList()}"-->
<!--                    class="list-group-item d-flex justify-content-between align-items-center">-->
<!--                    <span th:text="${stu.fullName} + ' (' + stu.email + ')'"></span>-->
<!--                    <div>-->
<!--                        <a th:href="@{'/dr/students/edit/' + ${stu.id}}" class="btn btn-sm btn-warning me-1">-->
<!--                            <i class="fas fa-edit"></i>-->
<!--                        </a>-->
<!--                        <form th:action="@{'/dr/students/remove/' + ${stu.id}}" method="post" class="d-inline">-->
<!--                            <button type="submit" class="btn btn-sm btn-danger">-->
<!--                                <i class="fas fa-user-slash"></i>-->
<!--                            </button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </li>-->
<!--            </ul>-->

<!--            &lt;!&ndash;            <ul class="list-group mb-2">&ndash;&gt;-->
<!--&lt;!&ndash;                <li th:each="stu : ${studentsMap[course.id]}" class="list-group-item d-flex justify-content-between align-items-center">&ndash;&gt;-->
<!--&lt;!&ndash;                    <span th:text="${stu.fullName} + ' (' + stu.email + ')'"></span>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div>&ndash;&gt;-->
<!--&lt;!&ndash;                        <a th:href="@{'/dr/students/edit/' + ${stu.id}}" class="btn btn-sm btn-warning me-1">&ndash;&gt;-->
<!--&lt;!&ndash;                            <i class="fas fa-edit"></i>&ndash;&gt;-->
<!--&lt;!&ndash;                        </a>&ndash;&gt;-->
<!--&lt;!&ndash;                        <form th:action="@{'/dr/students/remove/' + ${stu.id}}" method="post" class="d-inline">&ndash;&gt;-->
<!--&lt;!&ndash;                            <button type="submit" class="btn btn-sm btn-danger">&ndash;&gt;-->
<!--&lt;!&ndash;                                <i class="fas fa-user-slash"></i>&ndash;&gt;-->
<!--&lt;!&ndash;                            </button>&ndash;&gt;-->
<!--&lt;!&ndash;                        </form>&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                </li>&ndash;&gt;-->
<!--&lt;!&ndash;            </ul>&ndash;&gt;-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Pagination &ndash;&gt;-->
<!--    <nav th:if="${totalPages > 1}">-->
<!--        <ul class="pagination justify-content-center">-->
<!--            <li class="page-item" th:classappend="${currentPage == 0}? 'disabled'">-->
<!--                <a class="page-link" th:href="@{/dr/courses(page=${currentPage-1})}">Previous</a>-->
<!--            </li>-->
<!--            <li class="page-item" th:each="i : ${#numbers.sequence(0,totalPages-1)}"-->
<!--                th:classappend="${currentPage == i}? 'active'">-->
<!--                <a class="page-link" th:href="@{/dr/courses(page=${i})}" th:text="${i+1}"></a>-->
<!--            </li>-->
<!--            <li class="page-item" th:classappend="${currentPage == totalPages-1}? 'disabled'">-->
<!--                <a class="page-link" th:href="@{/dr/courses(page=${currentPage+1})}">Next</a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </nav>-->
<!--</section>-->

<script th:src="@{/js/manage-courses.js}"></script>
</html>
